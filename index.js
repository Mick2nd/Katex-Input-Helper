(()=>{var t={23:t=>{"use strict";t.exports=require("util")},24:(t,e,n)=>{"use strict";const i=n(236).fromCallback,r=n(735),o=n(928),s=n(798),c=n(288).pathExists;t.exports={outputFile:i((function(t,e,n,i){"function"==typeof n&&(i=n,n="utf8");const a=o.dirname(t);c(a,((o,c)=>o?i(o):c?r.writeFile(t,e,n,i):void s.mkdirs(a,(o=>{if(o)return i(o);r.writeFile(t,e,n,i)}))))})),outputFileSync:function(t,...e){const n=o.dirname(t);if(r.existsSync(n))return r.writeFileSync(t,...e);s.mkdirsSync(n),r.writeFileSync(t,...e)}}},64:(t,e,n)=>{"use strict";const i=n(735);t.exports={symlinkType:function(t,e,n){if(n="function"==typeof e?e:n,e="function"!=typeof e&&e)return n(null,e);i.lstat(t,((t,i)=>{if(t)return n(null,"file");e=i&&i.isDirectory()?"dir":"file",n(null,e)}))},symlinkTypeSync:function(t,e){let n;if(e)return e;try{n=i.lstatSync(t)}catch{return"file"}return n&&n.isDirectory()?"dir":"file"}}},106:(t,e,n)=>{var i=n(140),r=process.cwd,o=null,s=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return o||(o=r.call(process)),o};try{process.cwd()}catch(t){}if("function"==typeof process.chdir){var c=process.chdir;process.chdir=function(t){o=null,c.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,c)}t.exports=function(t){function e(e){return e?function(n,i,r){return e.call(t,n,i,(function(t){u(t)&&(t=null),r&&r.apply(this,arguments)}))}:e}function n(e){return e?function(n,i){try{return e.call(t,n,i)}catch(t){if(!u(t))throw t}}:e}function r(e){return e?function(n,i,r,o){return e.call(t,n,i,r,(function(t){u(t)&&(t=null),o&&o.apply(this,arguments)}))}:e}function o(e){return e?function(n,i,r){try{return e.call(t,n,i,r)}catch(t){if(!u(t))throw t}}:e}function c(e){return e?function(n,i,r){function o(t,e){e&&(e.uid<0&&(e.uid+=4294967296),e.gid<0&&(e.gid+=4294967296)),r&&r.apply(this,arguments)}return"function"==typeof i&&(r=i,i=null),i?e.call(t,n,i,o):e.call(t,n,o)}:e}function a(e){return e?function(n,i){var r=i?e.call(t,n,i):e.call(t,n);return r&&(r.uid<0&&(r.uid+=4294967296),r.gid<0&&(r.gid+=4294967296)),r}:e}function u(t){return!t||"ENOSYS"===t.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==t.code&&"EPERM"!==t.code)}var l;i.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(t){t.lchmod=function(e,n,r){t.open(e,i.O_WRONLY|i.O_SYMLINK,n,(function(e,i){e?r&&r(e):t.fchmod(i,n,(function(e){t.close(i,(function(t){r&&r(e||t)}))}))}))},t.lchmodSync=function(e,n){var r,o=t.openSync(e,i.O_WRONLY|i.O_SYMLINK,n),s=!0;try{r=t.fchmodSync(o,n),s=!1}finally{if(s)try{t.closeSync(o)}catch(t){}else t.closeSync(o)}return r}}(t),t.lutimes||function(t){i.hasOwnProperty("O_SYMLINK")&&t.futimes?(t.lutimes=function(e,n,r,o){t.open(e,i.O_SYMLINK,(function(e,i){e?o&&o(e):t.futimes(i,n,r,(function(e){t.close(i,(function(t){o&&o(e||t)}))}))}))},t.lutimesSync=function(e,n,r){var o,s=t.openSync(e,i.O_SYMLINK),c=!0;try{o=t.futimesSync(s,n,r),c=!1}finally{if(c)try{t.closeSync(s)}catch(t){}else t.closeSync(s)}return o}):t.futimes&&(t.lutimes=function(t,e,n,i){i&&process.nextTick(i)},t.lutimesSync=function(){})}(t),t.chown=r(t.chown),t.fchown=r(t.fchown),t.lchown=r(t.lchown),t.chmod=e(t.chmod),t.fchmod=e(t.fchmod),t.lchmod=e(t.lchmod),t.chownSync=o(t.chownSync),t.fchownSync=o(t.fchownSync),t.lchownSync=o(t.lchownSync),t.chmodSync=n(t.chmodSync),t.fchmodSync=n(t.fchmodSync),t.lchmodSync=n(t.lchmodSync),t.stat=c(t.stat),t.fstat=c(t.fstat),t.lstat=c(t.lstat),t.statSync=a(t.statSync),t.fstatSync=a(t.fstatSync),t.lstatSync=a(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(t,e,n){n&&process.nextTick(n)},t.lchmodSync=function(){}),t.chown&&!t.lchown&&(t.lchown=function(t,e,n,i){i&&process.nextTick(i)},t.lchownSync=function(){}),"win32"===s&&(t.rename="function"!=typeof t.rename?t.rename:function(e){function n(n,i,r){var o=Date.now(),s=0;e(n,i,(function c(a){if(a&&("EACCES"===a.code||"EPERM"===a.code||"EBUSY"===a.code)&&Date.now()-o<6e4)return setTimeout((function(){t.stat(i,(function(t,o){t&&"ENOENT"===t.code?e(n,i,c):r(a)}))}),s),void(s<100&&(s+=10));r&&r(a)}))}return Object.setPrototypeOf&&Object.setPrototypeOf(n,e),n}(t.rename)),t.read="function"!=typeof t.read?t.read:function(e){function n(n,i,r,o,s,c){var a;if(c&&"function"==typeof c){var u=0;a=function(l,f,d){if(l&&"EAGAIN"===l.code&&u<10)return u++,e.call(t,n,i,r,o,s,a);c.apply(this,arguments)}}return e.call(t,n,i,r,o,s,a)}return Object.setPrototypeOf&&Object.setPrototypeOf(n,e),n}(t.read),t.readSync="function"!=typeof t.readSync?t.readSync:(l=t.readSync,function(e,n,i,r,o){for(var s=0;;)try{return l.call(t,e,n,i,r,o)}catch(t){if("EAGAIN"===t.code&&s<10){s++;continue}throw t}})}},111:(t,e,n)=>{"use strict";const i=n(928);t.exports.checkPath=function(t){if("win32"===process.platform&&/[<>:"|?*]/.test(t.replace(i.parse(t).root,""))){const e=new Error(`Path contains invalid characters: ${t}`);throw e.code="EINVAL",e}}},140:t=>{"use strict";t.exports=require("constants")},143:(t,e)=>{"use strict";var n,i,r,o,s,c,a,u,l,f;Object.defineProperty(e,"__esModule",{value:!0}),e.ContentScriptType=e.SettingStorage=e.AppType=e.SettingItemSubType=e.SettingItemType=e.ToolbarButtonLocation=e.isContextMenuItemLocation=e.MenuItemLocation=e.ModelType=e.ImportModuleOutputFormat=e.FileSystemItem=void 0,(f=e.FileSystemItem||(e.FileSystemItem={})).File="file",f.Directory="directory",(l=e.ImportModuleOutputFormat||(e.ImportModuleOutputFormat={})).Markdown="md",l.Html="html",(u=e.ModelType||(e.ModelType={}))[u.Note=1]="Note",u[u.Folder=2]="Folder",u[u.Setting=3]="Setting",u[u.Resource=4]="Resource",u[u.Tag=5]="Tag",u[u.NoteTag=6]="NoteTag",u[u.Search=7]="Search",u[u.Alarm=8]="Alarm",u[u.MasterKey=9]="MasterKey",u[u.ItemChange=10]="ItemChange",u[u.NoteResource=11]="NoteResource",u[u.ResourceLocalState=12]="ResourceLocalState",u[u.Revision=13]="Revision",u[u.Migration=14]="Migration",u[u.SmartFilter=15]="SmartFilter",u[u.Command=16]="Command",function(t){t.File="file",t.Edit="edit",t.View="view",t.Note="note",t.Tools="tools",t.Help="help",t.Context="context",t.NoteListContextMenu="noteListContextMenu",t.EditorContextMenu="editorContextMenu",t.FolderContextMenu="folderContextMenu",t.TagContextMenu="tagContextMenu"}(n=e.MenuItemLocation||(e.MenuItemLocation={})),e.isContextMenuItemLocation=function(t){return[n.Context,n.NoteListContextMenu,n.EditorContextMenu,n.FolderContextMenu,n.TagContextMenu].includes(t)},(a=e.ToolbarButtonLocation||(e.ToolbarButtonLocation={})).NoteToolbar="noteToolbar",a.EditorToolbar="editorToolbar",(c=e.SettingItemType||(e.SettingItemType={}))[c.Int=1]="Int",c[c.String=2]="String",c[c.Bool=3]="Bool",c[c.Array=4]="Array",c[c.Object=5]="Object",c[c.Button=6]="Button",(s=e.SettingItemSubType||(e.SettingItemSubType={})).FilePathAndArgs="file_path_and_args",s.FilePath="file_path",s.DirectoryPath="directory_path",(o=e.AppType||(e.AppType={})).Desktop="desktop",o.Mobile="mobile",o.Cli="cli",(r=e.SettingStorage||(e.SettingStorage={}))[r.Database=1]="Database",r[r.File=2]="File",(i=e.ContentScriptType||(e.ContentScriptType={})).MarkdownItPlugin="markdownItPlugin",i.CodeMirrorPlugin="codeMirrorPlugin"},144:t=>{t.exports={stringify:function(t,{EOL:e="\n",finalEOL:n=!0,replacer:i=null,spaces:r}={}){const o=n?e:"";return JSON.stringify(t,i,r).replace(/\n/g,e)+o},stripBom:function(t){return Buffer.isBuffer(t)&&(t=t.toString("utf8")),t.replace(/^\uFEFF/,"")}}},156:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function c(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(n(998)),s=n(143),c=n(394),a=(n(278),n(238)),u=()=>i(void 0,void 0,void 0,(function*(){try{const e=new a.MathContext,n=yield e.displayMode();var t=new c.Dialog(!!n);yield t.create();let i=yield t.open();console.dir(i)}catch(t){console.error("Exception in command: "+t)}finally{console.info("Finally")}}));o.default.plugins.register({onStart:function(){return i(this,void 0,void 0,(function*(){console.info("Hello world. Test plugin started!");const t="pluginCommandKatexDialog";yield o.default.commands.register({name:t,label:"Katex Dialog",execute:u}),yield o.default.views.menuItems.create("mnuKatexImportHelper",t,s.MenuItemLocation.Tools,{accelerator:"CmdOrCtrl+Shift+K"})}))}})},188:(t,e,n)=>{"use strict";const{stringify:i}=n(144),{outputFileSync:r}=n(24);t.exports=function(t,e,n){const o=i(e,n);r(t,o,n)}},203:t=>{"use strict";t.exports=require("stream")},211:(t,e,n)=>{"use strict";const i=n(735);t.exports={utimesMillis:function(t,e,n,r){i.open(t,"r+",((t,o)=>{if(t)return r(t);i.futimes(o,e,n,(t=>{i.close(o,(e=>{r&&r(t||e)}))}))}))},utimesMillisSync:function(t,e,n){const r=i.openSync(t,"r+");return i.futimesSync(r,e,n),i.closeSync(r)}}},236:(t,e)=>{"use strict";e.fromCallback=function(t){return Object.defineProperty((function(...e){if("function"!=typeof e[e.length-1])return new Promise(((n,i)=>{e.push(((t,e)=>null!=t?i(t):n(e))),t.apply(this,e)}));t.apply(this,e)}),"name",{value:t.name})},e.fromPromise=function(t){return Object.defineProperty((function(...e){const n=e[e.length-1];if("function"!=typeof n)return t.apply(this,e);e.pop(),t.apply(this,e).then((t=>n(null,t)),n)}),"name",{value:t.name})}},238:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function c(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MathContext=void 0;const o=r(n(998));e.MathContext=class{constructor(){}displayMode(){return i(this,void 0,void 0,(function*(){const t=yield this.getValue(),e=yield this.cursorIndex(t),n=/(?<![\\$])((\$\$)|\$)([^{].*?)(\1)/gs;for(const i of t.matchAll(n)){const t=i[1],n=i[3];console.debug(`parse2 found : ${t} ${n} ${i[3]} `),console.debug("parse2 (whole match) : %O ",i);const r=i.index,o=r+i[0].length-1;if(console.debug(`parse2 from ${r} to ${o}`),r<=e&&e<=o)return"$$"===t}}))}eachLine(t){return i(this,void 0,void 0,(function*(){const e=yield this.getCursor(),n=e.line;var i=e.ch;const r=yield this.lastLine();for(var o=n;o<=r;o++){var s=yield this.getLine(o);if(s=s.substring(i),i=0,t(s))break}}))}cursorIndex(t){return i(this,void 0,void 0,(function*(){const e=yield this.getCursor(),n=e.line-(yield this.firstLine()),i=e.ch;let r=t.split("\n");r=r.slice(0,n+1),r[n]=r[n].substring(0,i);const o=r.join("\n");return(yield this.firstLine())>0&&console.warn("MathContext : irregular first line"),o.length}))}getLine(t){return i(this,void 0,void 0,(function*(){const e=yield this.execute("getLine",t);return console.debug(`Line from Editor : ${e} `),e}))}lineCount(){return i(this,void 0,void 0,(function*(){return yield this.execute("lineCount")}))}firstLine(){return i(this,void 0,void 0,(function*(){return yield this.execute("firstLine")}))}lastLine(){return i(this,void 0,void 0,(function*(){return yield this.execute("lastLine")}))}getCursor(){return i(this,void 0,void 0,(function*(){return yield this.execute("getCursor","to")}))}getValue(){return i(this,void 0,void 0,(function*(){return yield this.execute("getValue")}))}execute(t,...e){return i(this,void 0,void 0,(function*(){return yield o.default.commands.execute("editor.execCommand",{name:t,args:e})}))}}},244:(t,e,n)=>{"use strict";const i=n(735),r=n(928),o=n(423).copySync,s=n(422).removeSync,c=n(798).mkdirpSync,a=n(462);function u(t,e,n){try{i.renameSync(t,e)}catch(i){if("EXDEV"!==i.code)throw i;return function(t,e,n){return o(t,e,{overwrite:n,errorOnExist:!0}),s(t)}(t,e,n)}}t.exports=function(t,e,n){const o=(n=n||{}).overwrite||n.clobber||!1,{srcStat:l,isChangingCase:f=!1}=a.checkPathsSync(t,e,"move",n);return a.checkParentPathsSync(t,l,e,"move"),function(t){const e=r.dirname(t);return r.parse(e).root===e}(e)||c(r.dirname(e)),function(t,e,n,r){if(r)return u(t,e,n);if(n)return s(e),u(t,e,n);if(i.existsSync(e))throw new Error("dest already exists.");return u(t,e,n)}(t,e,o,f)}},249:(t,e,n)=>{"use strict";const i=n(735),r=n(928),o=n(613),s="win32"===process.platform;function c(t){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach((e=>{t[e]=t[e]||i[e],t[e+="Sync"]=t[e]||i[e]})),t.maxBusyTries=t.maxBusyTries||3}function a(t,e,n){let i=0;"function"==typeof e&&(n=e,e={}),o(t,"rimraf: missing path"),o.strictEqual(typeof t,"string","rimraf: path should be a string"),o.strictEqual(typeof n,"function","rimraf: callback function required"),o(e,"rimraf: invalid options argument provided"),o.strictEqual(typeof e,"object","rimraf: options should be object"),c(e),u(t,e,(function r(o){if(o){if(("EBUSY"===o.code||"ENOTEMPTY"===o.code||"EPERM"===o.code)&&i<e.maxBusyTries)return i++,setTimeout((()=>u(t,e,r)),100*i);"ENOENT"===o.code&&(o=null)}n(o)}))}function u(t,e,n){o(t),o(e),o("function"==typeof n),e.lstat(t,((i,r)=>i&&"ENOENT"===i.code?n(null):i&&"EPERM"===i.code&&s?l(t,e,i,n):r&&r.isDirectory()?d(t,e,i,n):void e.unlink(t,(i=>{if(i){if("ENOENT"===i.code)return n(null);if("EPERM"===i.code)return s?l(t,e,i,n):d(t,e,i,n);if("EISDIR"===i.code)return d(t,e,i,n)}return n(i)}))))}function l(t,e,n,i){o(t),o(e),o("function"==typeof i),e.chmod(t,438,(r=>{r?i("ENOENT"===r.code?null:n):e.stat(t,((r,o)=>{r?i("ENOENT"===r.code?null:n):o.isDirectory()?d(t,e,n,i):e.unlink(t,i)}))}))}function f(t,e,n){let i;o(t),o(e);try{e.chmodSync(t,438)}catch(t){if("ENOENT"===t.code)return;throw n}try{i=e.statSync(t)}catch(t){if("ENOENT"===t.code)return;throw n}i.isDirectory()?p(t,e,n):e.unlinkSync(t)}function d(t,e,n,i){o(t),o(e),o("function"==typeof i),e.rmdir(t,(s=>{!s||"ENOTEMPTY"!==s.code&&"EEXIST"!==s.code&&"EPERM"!==s.code?s&&"ENOTDIR"===s.code?i(n):i(s):function(t,e,n){o(t),o(e),o("function"==typeof n),e.readdir(t,((i,o)=>{if(i)return n(i);let s,c=o.length;if(0===c)return e.rmdir(t,n);o.forEach((i=>{a(r.join(t,i),e,(i=>{if(!s)return i?n(s=i):void(0==--c&&e.rmdir(t,n))}))}))}))}(t,e,i)}))}function y(t,e){let n;c(e=e||{}),o(t,"rimraf: missing path"),o.strictEqual(typeof t,"string","rimraf: path should be a string"),o(e,"rimraf: missing options"),o.strictEqual(typeof e,"object","rimraf: options should be object");try{n=e.lstatSync(t)}catch(n){if("ENOENT"===n.code)return;"EPERM"===n.code&&s&&f(t,e,n)}try{n&&n.isDirectory()?p(t,e,null):e.unlinkSync(t)}catch(n){if("ENOENT"===n.code)return;if("EPERM"===n.code)return s?f(t,e,n):p(t,e,n);if("EISDIR"!==n.code)throw n;p(t,e,n)}}function p(t,e,n){o(t),o(e);try{e.rmdirSync(t)}catch(i){if("ENOTDIR"===i.code)throw n;if("ENOTEMPTY"===i.code||"EEXIST"===i.code||"EPERM"===i.code)!function(t,e){if(o(t),o(e),e.readdirSync(t).forEach((n=>y(r.join(t,n),e))),!s)return e.rmdirSync(t,e);{const n=Date.now();do{try{return e.rmdirSync(t,e)}catch{}}while(Date.now()-n<500)}}(t,e);else if("ENOENT"!==i.code)throw i}}t.exports=a,a.sync=y},278:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function c(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.TestDialog=void 0;const o=r(n(998)),s=n(605),c=(n(857),n(928));var a=null;e.TestDialog=class{constructor(t){this.id="Katex Test Dialog",this.create=function(){return i(this,void 0,void 0,(function*(){null==a&&(a=yield o.default.views.dialogs.create(this.id)),yield o.default.views.panels.onMessage(a,(function(t){return i(this,void 0,void 0,(function*(){console.info(`Message from Webview: ${JSON.stringify(t)}`);var e=yield o.default.commands.execute("selectedText");return"Katex Test Dialog"==t.id&&"getparams"==t.cmd&&(t.equation=e,t)}))})),yield o.default.views.dialogs.setButtons(a,[{id:"okay",title:"Okay"},{id:"cancel",title:"Cancel"}]),yield o.default.views.dialogs.setFitToContent(a,!1),yield this.loadCss(a),yield this.loadJs(a),yield o.default.views.dialogs.setHtml(a,yield this.load("./tests/testDialog.html"))}))},this.open=function(){return i(this,void 0,void 0,(function*(){return yield o.default.views.dialogs.open(a)}))},this.load=function(t){return i(this,void 0,void 0,(function*(){let e=yield o.default.plugins.installationDir();return(yield s.readFile(c.join(e,t),"utf-8")).replace("${INSTALLDIR}",e)}))},this.loadCss=function(t){return i(this,void 0,void 0,(function*(){for(const e of[])yield o.default.views.dialogs.addScript(t,e)}))},this.loadJs=function(t){return i(this,void 0,void 0,(function*(){for(const e of["./assets/js/jquery-easyui/easyloader.js","./tests/starter.js"])yield o.default.views.dialogs.addScript(t,e)}))},this.archive=t}}},283:t=>{"use strict";t.exports=function(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Object)var n={__proto__:e(t)};else n=Object.create(null);return Object.getOwnPropertyNames(t).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})),n};var e=Object.getPrototypeOf||function(t){return t.__proto__}},288:(t,e,n)=>{"use strict";const i=n(236).fromPromise,r=n(737);t.exports={pathExists:i((function(t){return r.access(t).then((()=>!0)).catch((()=>!1))})),pathExistsSync:r.existsSync}},291:(t,e,n)=>{"use strict";const i=n(236).fromCallback,r=n(928),o=n(737),s=n(798),c=s.mkdirs,a=s.mkdirsSync,u=n(838),l=u.symlinkPaths,f=u.symlinkPathsSync,d=n(64),y=d.symlinkType,p=d.symlinkTypeSync,h=n(288).pathExists,{areIdentical:m}=n(462);function S(t,e,n,i){l(t,e,((s,a)=>{if(s)return i(s);t=a.toDst,y(a.toCwd,n,((n,s)=>{if(n)return i(n);const a=r.dirname(e);h(a,((n,r)=>n?i(n):r?o.symlink(t,e,s,i):void c(a,(n=>{if(n)return i(n);o.symlink(t,e,s,i)}))))}))}))}t.exports={createSymlink:i((function(t,e,n,i){i="function"==typeof n?n:i,n="function"!=typeof n&&n,o.lstat(e,((r,s)=>{!r&&s.isSymbolicLink()?Promise.all([o.stat(t),o.stat(e)]).then((([r,o])=>{if(m(r,o))return i(null);S(t,e,n,i)})):S(t,e,n,i)}))})),createSymlinkSync:function(t,e,n){let i;try{i=o.lstatSync(e)}catch{}if(i&&i.isSymbolicLink()){const n=o.statSync(t),i=o.statSync(e);if(m(n,i))return}const s=f(t,e);t=s.toDst,n=p(s.toCwd,n);const c=r.dirname(e);return o.existsSync(c)||a(c),o.symlinkSync(t,e,n)}}},314:(t,e,n)=>{"use strict";const i=n(735),r=n(928),o=n(423).copy,s=n(422).remove,c=n(798).mkdirp,a=n(288).pathExists,u=n(462);function l(t,e,n,i,r){return i?f(t,e,n,r):n?s(e,(i=>i?r(i):f(t,e,n,r))):void a(e,((i,o)=>i?r(i):o?r(new Error("dest already exists.")):f(t,e,n,r)))}function f(t,e,n,r){i.rename(t,e,(i=>i?"EXDEV"!==i.code?r(i):function(t,e,n,i){o(t,e,{overwrite:n,errorOnExist:!0},(e=>e?i(e):s(t,i)))}(t,e,n,r):r()))}t.exports=function(t,e,n,i){"function"==typeof n&&(i=n,n={});const o=(n=n||{}).overwrite||n.clobber||!1;u.checkPaths(t,e,"move",n,((n,s)=>{if(n)return i(n);const{srcStat:a,isChangingCase:f=!1}=s;u.checkParentPaths(t,a,e,"move",(n=>n?i(n):function(t){const e=r.dirname(t);return r.parse(e).root===e}(e)?l(t,e,o,f,i):void c(r.dirname(e),(n=>n?i(n):l(t,e,o,f,i)))))}))}},376:(t,e,n)=>{"use strict";const i=n(236).fromPromise,r=n(934);r.outputJson=i(n(426)),r.outputJsonSync=n(188),r.outputJSON=r.outputJson,r.outputJSONSync=r.outputJsonSync,r.writeJSON=r.writeJson,r.writeJSONSync=r.writeJsonSync,r.readJSON=r.readJson,r.readJSONSync=r.readJsonSync,t.exports=r},394:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function c(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Dialog=void 0;const o=r(n(998)),s=n(451),c=o.default.require("fs-extra"),a=n(928);var u=null;e.Dialog=class{constructor(t){this.id="Katex Input Helper Dialog",this.useEasyLoader=!1,this.installationDir="",this.create=function(){return i(this,void 0,void 0,(function*(){null==u&&(u=yield o.default.views.dialogs.create(this.id)),this.installationDir=yield o.default.plugins.installationDir(),yield this.loadCss(u),yield this.loadJs(u);var t=this;yield this.settings.register(),yield o.default.views.panels.onMessage(u,(function(e){return i(this,void 0,void 0,(function*(){console.info(`Message from Webview: ${JSON.stringify(e)}, setting dm to ${t.displayMode} `);var n=yield o.default.commands.execute("selectedText");return"Katex Input Helper"==e.id&&"getparams"==e.cmd?(yield t.settings.readSettings(e,n),e.equation=n,e.displayMode=t.displayMode,e):"Katex Input Helper"==e.id&&"sendparams"==e.cmd&&(console.debug("Message from WebView: %O",e),!0)}))})),yield o.default.views.dialogs.setButtons(u,[{id:"okay",title:"Okay"},{id:"cancel",title:"Cancel"}]),yield o.default.views.dialogs.setFitToContent(u,!1),yield o.default.views.dialogs.setHtml(u,yield this.load("./assets/dialog.html"))}))},this.open=function(){return i(this,void 0,void 0,(function*(){let t=yield o.default.views.dialogs.open(u);if(null==t.formData)return console.warn(`No formData returned on ${t.id}`),t;const e=t.formData.KATEX.hidden;if(!e)return console.warn(`No formData returned on ${t.id}`),t;console.debug(`Returned Json : ${e} `);let n=JSON.parse(e);return"okay"==t.id&&(yield o.default.commands.execute("editor.execCommand",{name:"replaceSelection",args:[n.equation]})),yield this.settings.writeSettings(n,"okay"!=t.id),t}))},this.load=function(t){return i(this,void 0,void 0,(function*(){let e=a.join(this.installationDir,t);return yield c.readFile(e,"utf-8")}))},this.loadCss=function(t){return i(this,void 0,void 0,(function*(){var e=this.useEasyLoader?[]:["./assets/styles.css"];for(const n of e)yield o.default.views.dialogs.addScript(t,n)}))},this.loadJs=function(t){return i(this,void 0,void 0,(function*(){var e=this.useEasyLoader?["./assets/js/jquery-easyui/easyloader.js","./assets/js/bootLoader.js"]:["./assets/bundle.js"];for(const n of e)yield o.default.views.dialogs.addScript(t,n)}))},this.displayMode=t,this.settings=new s.Settings}}},422:(t,e,n)=>{"use strict";const i=n(735),r=n(236).fromCallback,o=n(249);t.exports={remove:r((function(t,e){if(i.rm)return i.rm(t,{recursive:!0,force:!0},e);o(t,e)})),removeSync:function(t){if(i.rmSync)return i.rmSync(t,{recursive:!0,force:!0});o.sync(t)}}},423:(t,e,n)=>{"use strict";const i=n(236).fromCallback;t.exports={copy:i(n(994)),copySync:n(876)}},426:(t,e,n)=>{"use strict";const{stringify:i}=n(144),{outputFile:r}=n(24);t.exports=async function(t,e,n={}){const o=i(e,n);await r(t,o,n)}},451:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function c(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((i=i.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Settings=void 0;const o=r(n(998)),s=n(143);e.Settings=class{constructor(){this.fullyRegistered=!1,this.dialogSettingsPrefix="KIH_Location_",this.dialogs=["wf_BRACKET_SYMBOLS_MORE","wf_ARROW_SYMBOLS_MORE","wf_RELATION_SYMBOLS_MORE","wf_FR_CHAR_MORE","wf_BBB_CHAR_MORE","wf_L_U_GREEK_CHAR_MORE","wf_ALL_CHAR_MORE","wf_EQUATION_MORE","wf_COMMUTATIVE_DIAGRAM_MORE","wf_CHEMICAL_FORMULAE_MORE","wf_HORIZONTAL_SPACING_MORE","wf_VERTICAL_SPACING_MORE","wf_SPECIAL_CHARACTER_MORE","wf_CUSTOM_EQUATIONS_MORE","wEDITOR_PARAMETERS","wINFORMATIONS","wLANGUAGE_CHOISE","wSTYLE_CHOISE","wMATRIX","wLATEX_CODES_LIST","wASCIIMATH_CODES_LIST","wUNICODES_LIST","wLANGUAGE_LIST"]}register(){return i(this,void 0,void 0,(function*(){this.fullyRegistered||(this.settings=yield this.descriptions(),yield o.default.settings.registerSection(this.sectionName(),this.sectionLabel()),yield o.default.settings.registerSettings(this.settings),yield o.default.settings.onChange(this.onChange.bind(this)),this.fullyRegistered=!0)}))}onChange(t){console.info(`onChange triggered: ${t.keys}`),t.keys.includes("xxx")}descriptions(){return i(this,void 0,void 0,(function*(){var t={data_dir:{section:"KatexInputHelper.settings",public:!1,value:yield o.default.plugins.dataDir(),type:s.SettingItemType.String,description:"The data dir for the plugin."},style:{section:"KatexInputHelper.settings",public:!1,label:"Style",value:"aguas",type:s.SettingItemType.String,description:"The style of the plugin."},local_type:{section:"KatexInputHelper.settings",public:!1,label:"Local Type",value:"en_US",type:s.SettingItemType.String,description:"The Local Type of the plugin."},enclose_all_formula:{section:"KatexInputHelper.settings",public:!1,value:!1,type:s.SettingItemType.Bool},auto_update_time:{section:"KatexInputHelper.settings",public:!1,value:500,type:s.SettingItemType.Int},menu_update_type:{section:"KatexInputHelper.settings",public:!1,value:!0,type:s.SettingItemType.Bool},auto_update_type:{section:"KatexInputHelper.settings",public:!1,value:!0,type:s.SettingItemType.Bool},equation:{section:"KatexInputHelper.settings",public:!1,label:"Initial Equation",value:"\\vec{F} = \\frac{d \\vec{p}}{dt} = m \\frac{d \\vec{v}}{dt} = m \\vec{a}",type:s.SettingItemType.String,description:"The Initial Equation to be displayed."},equation_collection:{section:"KatexInputHelper.settings",public:!1,label:"Equation Collection",value:[],type:s.SettingItemType.Object,description:"A Equation Collection to be maintained by the customer"},persist_equations_on_cancel:{section:"KatexInputHelper.settings",public:!1,label:"Persist Equations On Cancel",value:!0,type:s.SettingItemType.Bool},persist_window_locations:{section:"KatexInputHelper.settings",public:!1,label:"Persist Window Locations",value:!0,type:s.SettingItemType.Bool}};return Object.assign(t,this.locationSettings())}))}locationSettings(){let t={};for(const e of this.dialogs)t[`${this.dialogSettingsPrefix}${e}`]={section:"KatexInputHelper.settings",public:!1,value:null,type:s.SettingItemType.Object,description:`Location settings for ${e} dialog`};return t}dialogIds(){return this.dialogs}locationPrefix(){return this.dialogSettingsPrefix}dialogSettingNames(){return this.dialogs.map((t=>`${this.dialogSettingsPrefix}${t}`))}readSettings(t,e){return i(this,void 0,void 0,(function*(){t.equation=e,t.style=yield this.style(),t.localType=yield this.localType(),t.encloseAllFormula=yield this.encloseAllFormula(),t.autoUpdateTime=yield this.autoUpdateTime(),t.autoupdateType=yield this.autoUpdateType(),t.menuupdateType=yield this.menuUpdateType(),t.persistEquations=yield this.persistEquations(),t.persistWindowPositions=yield this.persistWindowPositions(),t.equationCollection=yield this.equationCollection();for(const e of this.dialogIds()){const n=yield this.location(e);t[e]=n}}))}writeSettings(t,e=!1){return i(this,void 0,void 0,(function*(){if(console.info(`writeSettings: ${JSON.stringify(t)}`),yield this.setEquation(t.equation),yield this.setStyle(t.style),yield this.setLocalType(t.localType),yield this.setEncloseAllFormula(t.encloseAllFormula),yield this.setAutoUpdateTime(t.autoUpdateTime),yield this.setAutoUpdateType(t.autoupdateType),yield this.setMenuUpdateType(t.menuupdateType),yield this.setPersistEquations(t.persistEquations),yield this.setPersistWindowPositions(t.persistWindowPositions),!t.persistEquations&&e||(yield this.setEquationCollection(t.equationCollection)),t.persistWindowPositions)for(const e of this.dialogs)e in t&&(yield this.setLocation(e,t[e]))}))}style(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("style")}))}setStyle(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("style",t)}))}localType(){return i(this,void 0,void 0,(function*(){var t=yield o.default.settings.value("local_type");return console.info(`LocalType was: ${t}`),t}))}setLocalType(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("local_type",t)}))}encloseAllFormula(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("enclose_all_formula")}))}setEncloseAllFormula(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("enclose_all_formula",t)}))}autoUpdateTime(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("auto_update_time")}))}setAutoUpdateTime(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("auto_update_time",t)}))}menuUpdateType(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("menu_update_type")}))}setMenuUpdateType(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("menu_update_type",t)}))}autoUpdateType(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("auto_update_type")}))}setAutoUpdateType(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("auto_update_type",t)}))}equation(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("equation")}))}setEquation(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("equation",t)}))}persistEquations(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("persist_equations_on_cancel")}))}setPersistEquations(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("persist_equations_on_cancel",t)}))}persistWindowPositions(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("persist_window_locations")}))}setPersistWindowPositions(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("persist_window_locations",t)}))}equationCollection(){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value("equation_collection")}))}setEquationCollection(t){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue("equation_collection",t)}))}location(t){return i(this,void 0,void 0,(function*(){return yield o.default.settings.value(`${this.dialogSettingsPrefix}${t}`)}))}setLocation(t,e){return i(this,void 0,void 0,(function*(){yield o.default.settings.setValue(`${this.dialogSettingsPrefix}${t}`,e)}))}sectionName(){return"KatexInputHelper.settings"}sectionLabel(){return{label:"Katex Input Helper"}}}},455:(t,e,n)=>{"use strict";const i=n(236).fromCallback;t.exports={move:i(n(314)),moveSync:n(244)}},462:(t,e,n)=>{"use strict";const i=n(737),r=n(928),o=n(23);function s(t,e,n){const r=n.dereference?t=>i.stat(t,{bigint:!0}):t=>i.lstat(t,{bigint:!0});return Promise.all([r(t),r(e).catch((t=>{if("ENOENT"===t.code)return null;throw t}))]).then((([t,e])=>({srcStat:t,destStat:e})))}function c(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}function a(t,e){const n=r.resolve(t).split(r.sep).filter((t=>t)),i=r.resolve(e).split(r.sep).filter((t=>t));return n.reduce(((t,e,n)=>t&&i[n]===e),!0)}function u(t,e,n){return`Cannot ${n} '${t}' to a subdirectory of itself, '${e}'.`}t.exports={checkPaths:function(t,e,n,i,l){o.callbackify(s)(t,e,i,((i,o)=>{if(i)return l(i);const{srcStat:s,destStat:f}=o;if(f){if(c(s,f)){const i=r.basename(t),o=r.basename(e);return"move"===n&&i!==o&&i.toLowerCase()===o.toLowerCase()?l(null,{srcStat:s,destStat:f,isChangingCase:!0}):l(new Error("Source and destination must not be the same."))}if(s.isDirectory()&&!f.isDirectory())return l(new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`));if(!s.isDirectory()&&f.isDirectory())return l(new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`))}return s.isDirectory()&&a(t,e)?l(new Error(u(t,e,n))):l(null,{srcStat:s,destStat:f})}))},checkPathsSync:function(t,e,n,o){const{srcStat:s,destStat:l}=function(t,e,n){let r;const o=n.dereference?t=>i.statSync(t,{bigint:!0}):t=>i.lstatSync(t,{bigint:!0}),s=o(t);try{r=o(e)}catch(t){if("ENOENT"===t.code)return{srcStat:s,destStat:null};throw t}return{srcStat:s,destStat:r}}(t,e,o);if(l){if(c(s,l)){const i=r.basename(t),o=r.basename(e);if("move"===n&&i!==o&&i.toLowerCase()===o.toLowerCase())return{srcStat:s,destStat:l,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(s.isDirectory()&&!l.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!s.isDirectory()&&l.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(s.isDirectory()&&a(t,e))throw new Error(u(t,e,n));return{srcStat:s,destStat:l}},checkParentPaths:function t(e,n,o,s,a){const l=r.resolve(r.dirname(e)),f=r.resolve(r.dirname(o));if(f===l||f===r.parse(f).root)return a();i.stat(f,{bigint:!0},((i,r)=>i?"ENOENT"===i.code?a():a(i):c(n,r)?a(new Error(u(e,o,s))):t(e,n,f,s,a)))},checkParentPathsSync:function t(e,n,o,s){const a=r.resolve(r.dirname(e)),l=r.resolve(r.dirname(o));if(l===a||l===r.parse(l).root)return;let f;try{f=i.statSync(l,{bigint:!0})}catch(t){if("ENOENT"===t.code)return;throw t}if(c(n,f))throw new Error(u(e,o,s));return t(e,n,l,s)},isSrcSubdir:a,areIdentical:c}},522:(t,e,n)=>{"use strict";const i=n(236).fromCallback,r=n(928),o=n(735),s=n(798),c=n(288).pathExists,{areIdentical:a}=n(462);t.exports={createLink:i((function(t,e,n){function i(t,e){o.link(t,e,(t=>{if(t)return n(t);n(null)}))}o.lstat(e,((u,l)=>{o.lstat(t,((o,u)=>{if(o)return o.message=o.message.replace("lstat","ensureLink"),n(o);if(l&&a(u,l))return n(null);const f=r.dirname(e);c(f,((r,o)=>r?n(r):o?i(t,e):void s.mkdirs(f,(r=>{if(r)return n(r);i(t,e)}))))}))}))})),createLinkSync:function(t,e){let n;try{n=o.lstatSync(e)}catch{}try{const e=o.lstatSync(t);if(n&&a(e,n))return}catch(t){throw t.message=t.message.replace("lstat","ensureLink"),t}const i=r.dirname(e);return o.existsSync(i)||s.mkdirsSync(i),o.linkSync(t,e)}}},591:(t,e,n)=>{"use strict";const i=n(236).fromPromise,r=n(737),o=n(928),s=n(798),c=n(422),a=i((async function(t){let e;try{e=await r.readdir(t)}catch{return s.mkdirs(t)}return Promise.all(e.map((e=>c.remove(o.join(t,e)))))}));function u(t){let e;try{e=r.readdirSync(t)}catch{return s.mkdirsSync(t)}e.forEach((e=>{e=o.join(t,e),c.removeSync(e)}))}t.exports={emptyDirSync:u,emptydirSync:u,emptyDir:a,emptydir:a}},605:(t,e,n)=>{"use strict";t.exports={...n(737),...n(423),...n(591),...n(907),...n(376),...n(798),...n(455),...n(24),...n(288),...n(422)}},613:t=>{"use strict";t.exports=require("assert")},616:(t,e,n)=>{"use strict";const i=n(236).fromCallback,r=n(928),o=n(735),s=n(798);t.exports={createFile:i((function(t,e){function n(){o.writeFile(t,"",(t=>{if(t)return e(t);e()}))}o.stat(t,((i,c)=>{if(!i&&c.isFile())return e();const a=r.dirname(t);o.stat(a,((t,i)=>{if(t)return"ENOENT"===t.code?s.mkdirs(a,(t=>{if(t)return e(t);n()})):e(t);i.isDirectory()?n():o.readdir(a,(t=>{if(t)return e(t)}))}))}))})),createFileSync:function(t){let e;try{e=o.statSync(t)}catch{}if(e&&e.isFile())return;const n=r.dirname(t);try{o.statSync(n).isDirectory()||o.readdirSync(n)}catch(t){if(!t||"ENOENT"!==t.code)throw t;s.mkdirsSync(n)}o.writeFileSync(t,"")}}},735:(t,e,n)=>{var i,r,o=n(896),s=n(106),c=n(995),a=n(283),u=n(23);function l(t,e){Object.defineProperty(t,i,{get:function(){return e}})}"function"==typeof Symbol&&"function"==typeof Symbol.for?(i=Symbol.for("graceful-fs.queue"),r=Symbol.for("graceful-fs.previous")):(i="___graceful-fs.queue",r="___graceful-fs.previous");var f,d=function(){};if(u.debuglog?d=u.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(d=function(){var t=u.format.apply(u,arguments);t="GFS4: "+t.split(/\n/).join("\nGFS4: "),console.error(t)}),!o[i]){var y=global[i]||[];l(o,y),o.close=function(t){function e(e,n){return t.call(o,e,(function(t){t||m(),"function"==typeof n&&n.apply(this,arguments)}))}return Object.defineProperty(e,r,{value:t}),e}(o.close),o.closeSync=function(t){function e(e){t.apply(o,arguments),m()}return Object.defineProperty(e,r,{value:t}),e}(o.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",(function(){d(o[i]),n(613).equal(o[i].length,0)}))}function p(t){s(t),t.gracefulify=p,t.createReadStream=function(e,n){return new t.ReadStream(e,n)},t.createWriteStream=function(e,n){return new t.WriteStream(e,n)};var e=t.readFile;t.readFile=function(t,n,i){return"function"==typeof n&&(i=n,n=null),function t(n,i,r,o){return e(n,i,(function(e){!e||"EMFILE"!==e.code&&"ENFILE"!==e.code?"function"==typeof r&&r.apply(this,arguments):h([t,[n,i,r],e,o||Date.now(),Date.now()])}))}(t,n,i)};var n=t.writeFile;t.writeFile=function(t,e,i,r){return"function"==typeof i&&(r=i,i=null),function t(e,i,r,o,s){return n(e,i,r,(function(n){!n||"EMFILE"!==n.code&&"ENFILE"!==n.code?"function"==typeof o&&o.apply(this,arguments):h([t,[e,i,r,o],n,s||Date.now(),Date.now()])}))}(t,e,i,r)};var i=t.appendFile;i&&(t.appendFile=function(t,e,n,r){return"function"==typeof n&&(r=n,n=null),function t(e,n,r,o,s){return i(e,n,r,(function(i){!i||"EMFILE"!==i.code&&"ENFILE"!==i.code?"function"==typeof o&&o.apply(this,arguments):h([t,[e,n,r,o],i,s||Date.now(),Date.now()])}))}(t,e,n,r)});var r=t.copyFile;r&&(t.copyFile=function(t,e,n,i){return"function"==typeof n&&(i=n,n=0),function t(e,n,i,o,s){return r(e,n,i,(function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?"function"==typeof o&&o.apply(this,arguments):h([t,[e,n,i,o],r,s||Date.now(),Date.now()])}))}(t,e,n,i)});var o=t.readdir;t.readdir=function(t,e,n){"function"==typeof e&&(n=e,e=null);var i=a.test(process.version)?function(t,e,n,i){return o(t,r(t,e,n,i))}:function(t,e,n,i){return o(t,e,r(t,e,n,i))};return i(t,e,n);function r(t,e,n,r){return function(o,s){!o||"EMFILE"!==o.code&&"ENFILE"!==o.code?(s&&s.sort&&s.sort(),"function"==typeof n&&n.call(this,o,s)):h([i,[t,e,n],o,r||Date.now(),Date.now()])}}};var a=/^v[0-5]\./;if("v0.8"===process.version.substr(0,4)){var u=c(t);m=u.ReadStream,S=u.WriteStream}var l=t.ReadStream;l&&(m.prototype=Object.create(l.prototype),m.prototype.open=function(){var t=this;g(t.path,t.flags,t.mode,(function(e,n){e?(t.autoClose&&t.destroy(),t.emit("error",e)):(t.fd=n,t.emit("open",n),t.read())}))});var f=t.WriteStream;f&&(S.prototype=Object.create(f.prototype),S.prototype.open=function(){var t=this;g(t.path,t.flags,t.mode,(function(e,n){e?(t.destroy(),t.emit("error",e)):(t.fd=n,t.emit("open",n))}))}),Object.defineProperty(t,"ReadStream",{get:function(){return m},set:function(t){m=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WriteStream",{get:function(){return S},set:function(t){S=t},enumerable:!0,configurable:!0});var d=m;Object.defineProperty(t,"FileReadStream",{get:function(){return d},set:function(t){d=t},enumerable:!0,configurable:!0});var y=S;function m(t,e){return this instanceof m?(l.apply(this,arguments),this):m.apply(Object.create(m.prototype),arguments)}function S(t,e){return this instanceof S?(f.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}Object.defineProperty(t,"FileWriteStream",{get:function(){return y},set:function(t){y=t},enumerable:!0,configurable:!0});var v=t.open;function g(t,e,n,i){return"function"==typeof n&&(i=n,n=null),function t(e,n,i,r,o){return v(e,n,i,(function(s,c){!s||"EMFILE"!==s.code&&"ENFILE"!==s.code?"function"==typeof r&&r.apply(this,arguments):h([t,[e,n,i,r],s,o||Date.now(),Date.now()])}))}(t,e,n,i)}return t.open=g,t}function h(t){d("ENQUEUE",t[0].name,t[1]),o[i].push(t),S()}function m(){for(var t=Date.now(),e=0;e<o[i].length;++e)o[i][e].length>2&&(o[i][e][3]=t,o[i][e][4]=t);S()}function S(){if(clearTimeout(f),f=void 0,0!==o[i].length){var t=o[i].shift(),e=t[0],n=t[1],r=t[2],s=t[3],c=t[4];if(void 0===s)d("RETRY",e.name,n),e.apply(null,n);else if(Date.now()-s>=6e4){d("TIMEOUT",e.name,n);var a=n.pop();"function"==typeof a&&a.call(null,r)}else{var u=Date.now()-c,l=Math.max(c-s,1);u>=Math.min(1.2*l,100)?(d("RETRY",e.name,n),e.apply(null,n.concat([s]))):o[i].push(t)}void 0===f&&(f=setTimeout(S,0))}}global[i]||l(global,o[i]),t.exports=p(a(o)),process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!o.__patched&&(t.exports=p(o),o.__patched=!0)},737:(t,e,n)=>{"use strict";const i=n(236).fromCallback,r=n(735),o=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter((t=>"function"==typeof r[t]));Object.assign(e,r),o.forEach((t=>{e[t]=i(r[t])})),e.exists=function(t,e){return"function"==typeof e?r.exists(t,e):new Promise((e=>r.exists(t,e)))},e.read=function(t,e,n,i,o,s){return"function"==typeof s?r.read(t,e,n,i,o,s):new Promise(((s,c)=>{r.read(t,e,n,i,o,((t,e,n)=>{if(t)return c(t);s({bytesRead:e,buffer:n})}))}))},e.write=function(t,e,...n){return"function"==typeof n[n.length-1]?r.write(t,e,...n):new Promise(((i,o)=>{r.write(t,e,...n,((t,e,n)=>{if(t)return o(t);i({bytesWritten:e,buffer:n})}))}))},"function"==typeof r.writev&&(e.writev=function(t,e,...n){return"function"==typeof n[n.length-1]?r.writev(t,e,...n):new Promise(((i,o)=>{r.writev(t,e,...n,((t,e,n)=>{if(t)return o(t);i({bytesWritten:e,buffers:n})}))}))}),"function"==typeof r.realpath.native?e.realpath.native=i(r.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")},798:(t,e,n)=>{"use strict";const i=n(236).fromPromise,{makeDir:r,makeDirSync:o}=n(916),s=i(r);t.exports={mkdirs:s,mkdirsSync:o,mkdirp:s,mkdirpSync:o,ensureDir:s,ensureDirSync:o}},838:(t,e,n)=>{"use strict";const i=n(928),r=n(735),o=n(288).pathExists;t.exports={symlinkPaths:function(t,e,n){if(i.isAbsolute(t))return r.lstat(t,(e=>e?(e.message=e.message.replace("lstat","ensureSymlink"),n(e)):n(null,{toCwd:t,toDst:t})));{const s=i.dirname(e),c=i.join(s,t);return o(c,((e,o)=>e?n(e):o?n(null,{toCwd:c,toDst:t}):r.lstat(t,(e=>e?(e.message=e.message.replace("lstat","ensureSymlink"),n(e)):n(null,{toCwd:t,toDst:i.relative(s,t)})))))}},symlinkPathsSync:function(t,e){let n;if(i.isAbsolute(t)){if(n=r.existsSync(t),!n)throw new Error("absolute srcpath does not exist");return{toCwd:t,toDst:t}}{const o=i.dirname(e),s=i.join(o,t);if(n=r.existsSync(s),n)return{toCwd:s,toDst:t};if(n=r.existsSync(t),!n)throw new Error("relative srcpath does not exist");return{toCwd:t,toDst:i.relative(o,t)}}}}},857:t=>{"use strict";t.exports=require("os")},876:(t,e,n)=>{"use strict";const i=n(735),r=n(928),o=n(798).mkdirsSync,s=n(211).utimesMillisSync,c=n(462);function a(t,e,n,o){const s=(o.dereference?i.statSync:i.lstatSync)(e);if(s.isDirectory())return function(t,e,n,r,o){return e?f(n,r,o):function(t,e,n,r){return i.mkdirSync(n),f(e,n,r),l(n,t)}(t.mode,n,r,o)}(s,t,e,n,o);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return function(t,e,n,r,o){return e?function(t,e,n,r){if(r.overwrite)return i.unlinkSync(n),u(t,e,n,r);if(r.errorOnExist)throw new Error(`'${n}' already exists`)}(t,n,r,o):u(t,n,r,o)}(s,t,e,n,o);if(s.isSymbolicLink())return function(t,e,n,o){let s=i.readlinkSync(e);if(o.dereference&&(s=r.resolve(process.cwd(),s)),t){let t;try{t=i.readlinkSync(n)}catch(t){if("EINVAL"===t.code||"UNKNOWN"===t.code)return i.symlinkSync(s,n);throw t}if(o.dereference&&(t=r.resolve(process.cwd(),t)),c.isSrcSubdir(s,t))throw new Error(`Cannot copy '${s}' to a subdirectory of itself, '${t}'.`);if(i.statSync(n).isDirectory()&&c.isSrcSubdir(t,s))throw new Error(`Cannot overwrite '${t}' with '${s}'.`);return function(t,e){return i.unlinkSync(e),i.symlinkSync(t,e)}(s,n)}return i.symlinkSync(s,n)}(t,e,n,o);if(s.isSocket())throw new Error(`Cannot copy a socket file: ${e}`);if(s.isFIFO())throw new Error(`Cannot copy a FIFO pipe: ${e}`);throw new Error(`Unknown file: ${e}`)}function u(t,e,n,r){return i.copyFileSync(e,n),r.preserveTimestamps&&function(t,e,n){(function(t){return!(128&t)})(t)&&function(t,e){l(t,128|e)}(n,t),function(t,e){const n=i.statSync(t);s(e,n.atime,n.mtime)}(e,n)}(t.mode,e,n),l(n,t.mode)}function l(t,e){return i.chmodSync(t,e)}function f(t,e,n){i.readdirSync(t).forEach((i=>function(t,e,n,i){const o=r.join(e,t),s=r.join(n,t),{destStat:u}=c.checkPathsSync(o,s,"copy",i);return function(t,e,n,i){if(!i.filter||i.filter(e,n))return a(t,e,n,i)}(u,o,s,i)}(i,t,e,n)))}t.exports=function(t,e,n){"function"==typeof n&&(n={filter:n}),(n=n||{}).clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&process.emitWarning("Using the preserveTimestamps option in 32-bit node is not recommended;\n\n\tsee https://github.com/jprichardson/node-fs-extra/issues/269","Warning","fs-extra-WARN0002");const{srcStat:s,destStat:u}=c.checkPathsSync(t,e,"copy",n);return c.checkParentPathsSync(t,s,e,"copy"),function(t,e,n,s){if(s.filter&&!s.filter(e,n))return;const c=r.dirname(n);return i.existsSync(c)||o(c),a(t,e,n,s)}(u,t,e,n)}},896:t=>{"use strict";t.exports=require("fs")},907:(t,e,n)=>{"use strict";const{createFile:i,createFileSync:r}=n(616),{createLink:o,createLinkSync:s}=n(522),{createSymlink:c,createSymlinkSync:a}=n(291);t.exports={createFile:i,createFileSync:r,ensureFile:i,ensureFileSync:r,createLink:o,createLinkSync:s,ensureLink:o,ensureLinkSync:s,createSymlink:c,createSymlinkSync:a,ensureSymlink:c,ensureSymlinkSync:a}},909:(t,e,n)=>{let i;try{i=n(735)}catch(t){i=n(896)}const r=n(236),{stringify:o,stripBom:s}=n(144),c={readFile:r.fromPromise((async function(t,e={}){"string"==typeof e&&(e={encoding:e});const n=e.fs||i,o=!("throws"in e)||e.throws;let c,a=await r.fromCallback(n.readFile)(t,e);a=s(a);try{c=JSON.parse(a,e?e.reviver:null)}catch(e){if(o)throw e.message=`${t}: ${e.message}`,e;return null}return c})),readFileSync:function(t,e={}){"string"==typeof e&&(e={encoding:e});const n=e.fs||i,r=!("throws"in e)||e.throws;try{let i=n.readFileSync(t,e);return i=s(i),JSON.parse(i,e.reviver)}catch(e){if(r)throw e.message=`${t}: ${e.message}`,e;return null}},writeFile:r.fromPromise((async function(t,e,n={}){const s=n.fs||i,c=o(e,n);await r.fromCallback(s.writeFile)(t,c,n)})),writeFileSync:function(t,e,n={}){const r=n.fs||i,s=o(e,n);return r.writeFileSync(t,s,n)}};t.exports=c},916:(t,e,n)=>{"use strict";const i=n(737),{checkPath:r}=n(111),o=t=>"number"==typeof t?t:{mode:511,...t}.mode;t.exports.makeDir=async(t,e)=>(r(t),i.mkdir(t,{mode:o(e),recursive:!0})),t.exports.makeDirSync=(t,e)=>(r(t),i.mkdirSync(t,{mode:o(e),recursive:!0}))},928:t=>{"use strict";t.exports=require("path")},934:(t,e,n)=>{"use strict";const i=n(909);t.exports={readJson:i.readFile,readJsonSync:i.readFileSync,writeJson:i.writeFile,writeJsonSync:i.writeFileSync}},994:(t,e,n)=>{"use strict";const i=n(735),r=n(928),o=n(798).mkdirs,s=n(288).pathExists,c=n(211).utimesMillis,a=n(462);function u(t,e,n,i,c){const a=r.dirname(n);s(a,((r,s)=>r?c(r):s?f(t,e,n,i,c):void o(a,(r=>r?c(r):f(t,e,n,i,c)))))}function l(t,e,n,i,r,o){Promise.resolve(r.filter(n,i)).then((s=>s?t(e,n,i,r,o):o()),(t=>o(t)))}function f(t,e,n,o,s){(o.dereference?i.stat:i.lstat)(e,((c,u)=>c?s(c):u.isDirectory()?function(t,e,n,r,o,s){return e?h(n,r,o,s):function(t,e,n,r,o){i.mkdir(n,(i=>{if(i)return o(i);h(e,n,r,(e=>e?o(e):p(n,t,o)))}))}(t.mode,n,r,o,s)}(u,t,e,n,o,s):u.isFile()||u.isCharacterDevice()||u.isBlockDevice()?function(t,e,n,r,o,s){return e?function(t,e,n,r,o){if(!r.overwrite)return r.errorOnExist?o(new Error(`'${n}' already exists`)):o();i.unlink(n,(i=>i?o(i):d(t,e,n,r,o)))}(t,n,r,o,s):d(t,n,r,o,s)}(u,t,e,n,o,s):u.isSymbolicLink()?function(t,e,n,o,s){i.readlink(e,((e,c)=>e?s(e):(o.dereference&&(c=r.resolve(process.cwd(),c)),t?void i.readlink(n,((e,u)=>e?"EINVAL"===e.code||"UNKNOWN"===e.code?i.symlink(c,n,s):s(e):(o.dereference&&(u=r.resolve(process.cwd(),u)),a.isSrcSubdir(c,u)?s(new Error(`Cannot copy '${c}' to a subdirectory of itself, '${u}'.`)):t.isDirectory()&&a.isSrcSubdir(u,c)?s(new Error(`Cannot overwrite '${u}' with '${c}'.`)):function(t,e,n){i.unlink(e,(r=>r?n(r):i.symlink(t,e,n)))}(c,n,s)))):i.symlink(c,n,s))))}(t,e,n,o,s):u.isSocket()?s(new Error(`Cannot copy a socket file: ${e}`)):u.isFIFO()?s(new Error(`Cannot copy a FIFO pipe: ${e}`)):s(new Error(`Unknown file: ${e}`))))}function d(t,e,n,r,o){i.copyFile(e,n,(i=>i?o(i):r.preserveTimestamps?function(t,e,n,i){return function(t){return!(128&t)}(t)?function(t,e,n){return p(t,128|e,n)}(n,t,(r=>r?i(r):y(t,e,n,i))):y(t,e,n,i)}(t.mode,e,n,o):p(n,t.mode,o)))}function y(t,e,n,r){!function(t,e,n){i.stat(t,((t,i)=>t?n(t):c(e,i.atime,i.mtime,n)))}(e,n,(e=>e?r(e):p(n,t,r)))}function p(t,e,n){return i.chmod(t,e,n)}function h(t,e,n,r){i.readdir(t,((i,o)=>i?r(i):m(o,t,e,n,r)))}function m(t,e,n,i,o){const s=t.pop();return s?function(t,e,n,i,o,s){const c=r.join(n,e),u=r.join(i,e);a.checkPaths(c,u,"copy",o,((e,r)=>{if(e)return s(e);const{destStat:a}=r;!function(t,e,n,i,r){i.filter?l(f,t,e,n,i,r):f(t,e,n,i,r)}(a,c,u,o,(e=>e?s(e):m(t,n,i,o,s)))}))}(t,s,e,n,i,o):o()}t.exports=function(t,e,n,i){"function"!=typeof n||i?"function"==typeof n&&(n={filter:n}):(i=n,n={}),i=i||function(){},(n=n||{}).clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&process.emitWarning("Using the preserveTimestamps option in 32-bit node is not recommended;\n\n\tsee https://github.com/jprichardson/node-fs-extra/issues/269","Warning","fs-extra-WARN0001"),a.checkPaths(t,e,"copy",n,((r,o)=>{if(r)return i(r);const{srcStat:s,destStat:c}=o;a.checkParentPaths(t,s,e,"copy",(r=>r?i(r):n.filter?l(u,c,t,e,n,i):u(c,t,e,n,i)))}))}},995:(t,e,n)=>{var i=n(203).Stream;t.exports=function(t){return{ReadStream:function e(n,r){if(!(this instanceof e))return new e(n,r);i.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=65536,r=r||{};for(var s=Object.keys(r),c=0,a=s.length;c<a;c++){var u=s[c];this[u]=r[u]}if(this.encoding&&this.setEncoding(this.encoding),void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}null===this.fd?t.open(this.path,this.flags,this.mode,(function(t,e){if(t)return o.emit("error",t),void(o.readable=!1);o.fd=e,o.emit("open",e),o._read()})):process.nextTick((function(){o._read()}))},WriteStream:function e(n,r){if(!(this instanceof e))return new e(n,r);i.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,r=r||{};for(var o=Object.keys(r),s=0,c=o.length;s<c;s++){var a=o[s];this[a]=r[a]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],null===this.fd&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}}},998:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=joplin}},e={};!function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}(156)})();